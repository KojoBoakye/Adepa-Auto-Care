<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>New Service Entry - Adepa Auto Care</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap">
    <link rel="stylesheet" href="styles.css">
</head>
<body class="attendant-theme">
    <div class="dashboard-container attendant-container">
        <header class="dashboard-header">
            <div class="branding">
                <img src="images/logo.jpeg" alt="Washing Bay Logo" class="logo">
            </div>
         
            <button id="themeToggle" class="theme-toggle">
                <span class="dark-icon">üåô</span>
                <span class="light-icon">‚òÄÔ∏è</span>
            </button>

            
            <!-- Add this logout button to the header-actions div in attendant.html -->
            <button class="btn logout-btn" onclick="logout()">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                    <path d="M10 12.5a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 .5.5v2a.5.5 0 0 0 1 0v-2A1.5 1.5 0 0 0 9.5 2h-8A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-2a.5.5 0 0 0-1 0v2z"/>
                    <path d="M15.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 0 0-.708.708L14.293 7.5H5.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0 .708.708l3-3z"/>
                </svg>
                Logout
            </button>
        </header>

        <div class="entry-form-container">
            <form id="entryForm" class="modern-form">
                <div class="form-grid">
                    <div class="form-section">
                        <h3 class="section-title">Vehicle Details</h3>
                        <div class="input-group">
                            <label>Car Model</label>
                            <input type="text" id="carModel" required>
                        </div>
                        <div class="input-group">
                            <label>Car Type/Make</label>
                            <input type="text" id="carType" required>
                        </div>
                        <div class="input-group">
                            <label>Car Number</label>
                            <input type="text" id="carNumber" required>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3 class="section-title">Service Details</h3>
                        <div class="input-group">
                            <label>Primary Service</label>
                            <input type="text" id="serviceType1" list="primaryServices" required 
                                   placeholder="Select or type service">
                            <datalist id="primaryServices">
                                <option value="Body Wash">
                                <option value="Under Wash">
                                <option value="Engine Wash">
                                <option value="Full Detailing">
                                <option value="Rust Proofing">
                            </datalist>
                        </div>
                        <div class="input-group">
                            <label>Secondary Service</label>
                            <input type="text" id="serviceType2" list="secondaryServices" placeholder="Optional">
                            <datalist id="secondaryServices">
                                <option value="Inside Detailing">
                                <option value="Hoovering">
                                <option value="Polish">
                                <option value="Waxing">
                            </datalist>
                        </div>
                        <div class="input-group">
                            <label>Washer Name</label>
                            <input type="text" id="washerName" required>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3 class="section-title">Payment Details</h3>
                        <div class="input-group">
                            <label>Mobile Number</label>
                            <input type="tel" id="mobileNumber" pattern="[0-9]{10}" placeholder="Enter 10-digit mobile number" required>
                        </div>
                        <div class="input-group">
                            <label>Email (Optional)</label>
                            <input type="email" id="email" placeholder="Enter email address">
                        </div>
                        <div class="input-group">
                            <label>Payment Type</label>
                            <select id="paymentType" required>
                                <option value="">Select payment type</option>
                                <option value="cash">Cash</option>
                                <option value="cheque">Cheque</option>
                                <option value="card">Card</option>
                                <option value="mobile_money">Mobile Money</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label>Total Amount (GHS)</label>
                            <input type="number" id="amount" required>
                        </div>
                        <div class="input-group">
                            <label>Washer Commission (GHS)</label>
                            <input type="number" id="washerCommission" required>
                        </div>
                        <div class="input-group">
                            <label>Company Commission (GHS)</label>
                            <input type="number" id="companyCommission" required>
                        </div>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="reset" class="btn clear-btn">Clear Form</button>
                    <button type="submit" class="btn submit-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-save" viewBox="0 0 16 16">
                            <path d="M2 1a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H9.5a1 1 0 0 0-1 1v7.293l2.646-2.647a.5.5 0 0 1 .708.708l-3.5 3.5a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L7.5 9.293V2a2 2 0 0 1 2-2H14a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h2.5a.5.5 0 0 1 0 1H2z"/>
                        </svg>
                        Save Entry
                    </button>
                </div>
            </form>
        </div>

        <div class="loading-overlay" id="loading">
            <div class="loading-spinner"></div>
        </div>

        <!-- Confirmation Modal -->
        <div id="confirmationModal" class="modal-overlay">
            <div class="modal-content">
                <h3>Final Confirmation</h3>
                <p>Once submitted, this entry cannot be edited. Are you sure you want to proceed?</p>
                <div class="modal-buttons">
                    <button class="modal-button cancel-btn" id="cancelSubmit">Go Back</button>
                    <button class="modal-button confirm-btn" id="confirmSubmit">Confirm</button>
                </div>
            </div>
        </div>
    </div>
    <div id="passwordModal" class="modal-overlay">
        <div class="modal-content">
            <h3>Change Password</h3>
            <div id="passwordError" class="error-message"></div>
            <div id="passwordSuccess" class="success-message"></div>
            <form id="passwordForm" class="password-form">
                <div class="input-group">
                    <label>Current Password</label>
                    <input type="password" id="currentPassword" required>
                </div>
                <div class="input-group">
                    <label>New Password</label>
                    <input type="password" id="newPassword" required>
                </div>
                <div class="input-group">
                    <label>Confirm New Password</label>
                    <input type="password" id="confirmPassword" required>
                </div>
                <div class="modal-buttons">
                    <button type="button" class="modal-button cancel-btn" onclick="closePasswordModal()">Cancel</button>
                    <button type="submit" class="modal-button confirm-btn">Change Password</button>
                </div>
            </form>
        </div>
    </div>
    

    <script>
        // Form Submission Handling
        const form = document.getElementById('entryForm');
        const confirmationModal = document.getElementById('confirmationModal');
        const cancelSubmit = document.getElementById('cancelSubmit');
        const confirmSubmit = document.getElementById('confirmSubmit');

        form.addEventListener('submit', (e) => {
            e.preventDefault();
            confirmationModal.style.display = 'flex';
        });

        cancelSubmit.addEventListener('click', () => {
            confirmationModal.style.display = 'none';
        });

        confirmSubmit.addEventListener('click', async () => {
            confirmationModal.style.display = 'none';
            const loading = document.getElementById('loading');
            
            try {
                loading.style.display = 'flex';
                
                const data = {
                    carModel: document.getElementById('carModel').value,
                    carType: document.getElementById('carType').value,
                    carNumber: document.getElementById('carNumber').value,
                    serviceType1: document.getElementById('serviceType1').value,
                    serviceType2: document.getElementById('serviceType2').value,
                    washerName: document.getElementById('washerName').value,
                    mobileNumber: document.getElementById('mobileNumber').value,
                    email: document.getElementById('email').value,
                    paymentType: document.getElementById('paymentType').value,
                    amount: document.getElementById('amount').value,
                    washerCommission: document.getElementById('washerCommission').value,
                    companyCommission: document.getElementById('companyCommission').value
                };

                const response = await fetch('https://adepa-auto-care.vercel.app/save', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    showSuccessMessage();
                    form.reset();
                }
            } catch (error) {
                console.error('Error:', error);
                showErrorMessage();
            } finally {
                loading.style.display = 'none';
            }
        });

        function showSuccessMessage() {
            const msg = document.createElement('div');
            msg.className = 'success-message';
            msg.textContent = 'Entry saved successfully!';
            document.body.appendChild(msg);
            setTimeout(() => msg.remove(), 3000);
        }

        function showErrorMessage() {
            const msg = document.createElement('div');
            msg.className = 'error-message';
            msg.textContent = 'Error saving entry. Please try again.';
            document.body.appendChild(msg);
            setTimeout(() => msg.remove(), 3000);
        }

        // Theme Toggle
        const themeToggle = document.getElementById('themeToggle');
        const storedTheme = localStorage.getItem('theme') || 'light';
        document.documentElement.setAttribute('data-theme', storedTheme);

        themeToggle.addEventListener('click', () => {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
        });

        function logout() {
        localStorage.removeItem('userRole');
        localStorage.removeItem('username');
        window.location.href = 'login.html';
    }
    
    // Password change modal functions
    function openPasswordModal() {
        document.getElementById('passwordModal').style.display = 'flex';
        document.getElementById('passwordError').style.display = 'none';
        document.getElementById('passwordSuccess').style.display = 'none';
        document.getElementById('passwordForm').reset();
    }
    
    function closePasswordModal() {
        document.getElementById('passwordModal').style.display = 'none';
    }
    
    // Initialize password form event listener
    document.getElementById('passwordForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const currentPassword = document.getElementById('currentPassword').value;
        const newPassword = document.getElementById('newPassword').value;
        const confirmPassword = document.getElementById('confirmPassword').value;
        
        // Get stored attendant password
        const storedPassword = localStorage.getItem('attendantPassword') || 'client.adepa';
        
        // Show error if current password is incorrect
        if (currentPassword !== storedPassword) {
            document.getElementById('passwordError').textContent = 'Current password is incorrect';
            document.getElementById('passwordError').style.display = 'block';
            document.getElementById('passwordSuccess').style.display = 'none';
            return;
        }
        
        // Show error if new passwords don't match
        if (newPassword !== confirmPassword) {
            document.getElementById('passwordError').textContent = 'New passwords do not match';
            document.getElementById('passwordError').style.display = 'block';
            document.getElementById('passwordSuccess').style.display = 'none';
            return;
        }
        
        // Update the password
        localStorage.setItem('attendantPassword', newPassword);
        
        // Show success message
        document.getElementById('passwordSuccess').textContent = 'Password changed successfully';
        document.getElementById('passwordSuccess').style.display = 'block';
        document.getElementById('passwordError').style.display = 'none';
        
        // Close modal after 2 seconds
        setTimeout(closePasswordModal, 2000);
    });

    function showSuccessMessage() {
    const msg = document.createElement('div');
    msg.className = 'success-message';
    msg.textContent = 'Entry saved successfully!';
    document.body.appendChild(msg);

    // Remove the message after 3 seconds
    setTimeout(() => {
        msg.remove();
    }, 3000);
}

function showErrorMessage() {
    const msg = document.createElement('div');
    msg.className = 'error-message';
    msg.textContent = 'Error saving entry. Please try again.';
    document.body.appendChild(msg);

    // Remove the message after 3 seconds
    setTimeout(() => {
        msg.remove();
    }, 3000);
}

function showSuccessMessage() {
    const msg = document.createElement('div');
    msg.className = 'success-message';
    msg.textContent = 'Entry saved successfully!';
    document.body.appendChild(msg);

    // Remove the message after 3 seconds
    setTimeout(() => {
        msg.remove();
    }, 3000);
}

function showErrorMessage() {
    const msg = document.createElement('div');
    msg.className = 'error-message';
    msg.textContent = 'Error saving entry. Please try again.';
    document.body.appendChild(msg);

    // Remove the message after 3 seconds
    setTimeout(() => {
        msg.remove();
    }, 3000);
}




    </script>
</body>
</html>